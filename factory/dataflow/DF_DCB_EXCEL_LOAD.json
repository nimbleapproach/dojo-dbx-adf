{
	"name": "DF_DCB_EXCEL_LOAD",
	"properties": {
		"folder": {
			"name": "DCB"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DS_ADLS_DV_DCB_EXCEL",
						"type": "DatasetReference"
					},
					"name": "GetExcelFile"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "LS_ADLS",
						"type": "LinkedServiceReference"
					},
					"name": "WriteDeltaFiles"
				}
			],
			"transformations": [
				{
					"name": "Partition"
				},
				{
					"name": "AddSystemColumns",
					"description": "Creating/updating the columns 'Sys_Bronze_InsertDateTime_UTC'"
				}
			],
			"scriptLines": [
				"parameters{",
				"     pm_FileName as string",
				"}",
				"source(output(",
				"          Invoice as string,",
				"          {Invoice date} as string,",
				"          {Invoice month} as string,",
				"          {Invoice year} as string,",
				"          {SO number} as string,",
				"          {SO date} as string,",
				"          {Reseller ID} as string,",
				"          Reseller as string,",
				"          {VAT number} as string,",
				"          SKU as string,",
				"          Description as string,",
				"          Remark as string,",
				"          Qty as string,",
				"          {Price/unit} as string,",
				"          {% line discount} as string,",
				"          {amount line discount} as string,",
				"          {Net/price} as string,",
				"          {Total invoice} as string,",
				"          Entity as string,",
				"          Vendor as string,",
				"          {Vendor ID} as string,",
				"          {Product Type} as string,",
				"          {Article Group} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: true,",
				"     moveFiles: ['dcb/pending','dcb/archived'],",
				"     rowUrlColumn: 'Sys_FileName') ~> GetExcelFile",
				"GetExcelFile window(over(Invoice),",
				"     asc(SKU, true),",
				"     LineNo = rowNumber()) ~> Partition",
				"Partition derive(Sys_Bronze_InsertDateTime_UTC = currentUTC()) ~> AddSystemColumns",
				"AddSystemColumns sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'parquet',",
				"     fileSystem: 'bronze',",
				"     folderPath: 'dcb/invoicedata',",
				"     compressionCodec: 'snappy',",
				"     partitionFileNames:[(concat('bronze-dcb-',$pm_FileName,'-',toString(currentUTC()),'.snappy.parquet')\r",
				")],",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     mapColumn(",
				"          Invoice,",
				"          Invoice_Date = {Invoice date},",
				"          Invoice_Month = {Invoice month},",
				"          Invoice_Year = {Invoice year},",
				"          SO_Number = {SO number},",
				"          SO_Date = {SO date},",
				"          Reseller_ID = {Reseller ID},",
				"          Reseller,",
				"          VAT_Number = {VAT number},",
				"          SKU,",
				"          Description,",
				"          Remark,",
				"          Qty,",
				"          Unit_Price = {Price/unit},",
				"          Line_Discount_Percentage = {% line discount},",
				"          Line_Discount_Euro = {amount line discount},",
				"          Net_Price = {Net/price},",
				"          Total_Invoice = {Total invoice},",
				"          Entity,",
				"          Vendor,",
				"          Vendor_ID = {Vendor ID},",
				"          Product_Type = {Product Type},",
				"          Article_Group = {Article Group},",
				"          Sys_FileName,",
				"          LineNo,",
				"          Sys_Bronze_InsertDateTime_UTC",
				"     ),",
				"     partitionBy('hash', 1)) ~> WriteDeltaFiles"
			]
		}
	}
}